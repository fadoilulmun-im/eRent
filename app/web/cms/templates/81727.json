{"content":{"type":"API","structure":"","server_on_load":"async ({\n  template,\n  params,\n  render,\n  db,\n  req,\n  reply,\n  user,\n  log,\n  ext,\n  isDev,\n}: Server) => {\n  const {\n    tanggal_peminjaman,\n    tanggal_pengembalian,\n    bank,\n    kirim,\n    alamat,\n  } = req.body;\n\n  // To calculate the time difference of two dates\n  const Difference_In_Time =\n    new Date(tanggal_pengembalian).getTime() -\n    new Date(tanggal_peminjaman).getTime();\n  // To calculate the no. of days between two dates\n  const Difference_In_Days = Difference_In_Time / (1000 * 3600 * 24);\n\n  const detail_transaksi = await db.detail_transaksi.findMany({\n    where: {\n      id_transaksi: Number(params.id),\n    },\n    select: {\n      total_harga: true,\n    },\n  });\n\n  // menjumlah semua harga dalam keranjang\n  let harga = 0;\n  detail_transaksi.forEach((i) => {\n    harga = harga + i.total_harga;\n  });\n\n  const unique_code = Math.floor(Math.random() * 200) + 101;\n\n  // jumlah harga * total hari peminjaman + kode unik\n  const total_harga = harga * Difference_In_Days + unique_code;\n\n  const transaksi = await db.transaksi.update({\n    where: {\n      id: Number(params.id),\n    },\n    data: {\n      tanggal_pemesanan: new Date(),\n      tanggal_peminjaman: new Date(tanggal_peminjaman),\n      tanggal_pengembalian: new Date(tanggal_pengembalian),\n      status_transaksi: 8,\n      total_harga,\n      kode_unik: unique_code,\n      is_kirim: kirim,\n      id_bank: bank,\n      id_alamat: alamat,\n    },\n  });\n\n  reply.send({\n    status: \"SUCCESS\",\n    message: \"Berhasil melakukan pemesanan\",\n    data: transaksi,\n  })\n}","figma":{}},"title":"checkout","type":"cms-template","lang":"","status":"SYSTEM","parent_id":"14213","slug":"/api/checkout/[id]","site":"*","id":"81727"}