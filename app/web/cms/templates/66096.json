{"content":{"type":"API","structure":"","server_on_load":"async ({\n  template,\n  params,\n  render,\n  db,\n  req,\n  reply,\n  user,\n  log,\n  ext,\n  isDev,\n}: Server) => {\n  if (user.user.role == \"guest\") {\n    return reply.status(401).send({\n      status: \"ERROR\",\n      message: \"Silahkan login terlebih dahulu\",\n    });\n  }\n  if (user.user.role == \"customer\") {\n    return reply.status(403).send({\n      status: \"ERROR\",\n      message: \"Hanya admin yang bisa mengakses ini\",\n    });\n  }\n\n  let id = Number(params.id);\n  // id = id.split(\",\").map(function (item) {\n  //   return Number(item);\n  // });\n  const getUser = await db.customer.findFirst({\n    where: {\n      AND: {\n        id: id,\n        // NOT: {\n        //   status: true,\n        // },\n        status: null,\n      },\n    },\n  });\n\n  if (!getUser) {\n    return reply.status(404).send({\n      status: \"ERROR\",\n      message:\n        \"Tidak ada customer dengan id yang dimasukkan / sudah di approve\",\n      data: getUser,\n    });\n  }\n\n  const customer = await db.customer.update({\n    where: {\n      id: id,\n    },\n    data: {\n      status: true,\n    },\n  });\n\n  if (customer) {\n    // getUser.forEach(async (item) => {\n    //   const send = await ext.sendEmail(\n    //     item.email,\n    //     \"Account has been approved\",\n    //     `<h3>Akun anda sudah disetujui oleh admin, silahkan menikmati fasilitas yang ada</h3>`\n    //   );\n    //   if (!send) {\n    //     console.log(\"Email tidak terkirim ke : \", item.email);\n    //   }\n    // });\n    const send = await ext.sendEmail(\n      customer.email,\n      \"Account has been approved\",\n      `<h3>Akun anda sudah disetujui oleh admin, silahkan menikmati fasilitas yang ada</h3>`\n    );\n    if (!send) {\n      console.log(\"Email tidak terkirim ke : \", customer.email);\n    }\n\n    return reply.send({\n      status: \"SUCCESS\",\n      message: \"Berhasil approve customer\",\n      data: customer,\n    });\n  }\n\n  return reply.status(500).send({\n    status: \"Error\",\n    message: \"Gagal approve customer\",\n  })\n}","figma":{}},"title":"approve-customer","type":"cms-template","lang":"","status":"SYSTEM","parent_id":"54643","slug":"/api/customer/[id]/approve","site":"*","id":"66096"}