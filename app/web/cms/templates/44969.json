{"content":{"type":"API","structure":"","server_on_load":"async ({\n  template,\n  params,\n  render,\n  db,\n  req,\n  reply,\n  user,\n  log,\n  ext,\n  isDev,\n}: Server) => {\n  const take = req.query.take ? req.query.take : 10;\n\n  // mengambil semua id barang di tabel detail_transaksi\n  const pesanan = await db.detail_transaksi.findMany({\n    select: {\n      id_barang: true,\n    },\n  });\n\n  // menghitung berapa kali barang dipesan\n  let count = {};\n  pesanan.forEach((i) => {\n    count[i.id_barang] = (count[i.id_barang] || 0) + 1;\n  });\n\n  // mengambil 10 id barang dengan pesanan terbanyak\n  const id_favorit = [];\n  for (let i = 0; i < Number(take); i++) {\n    let max = Object.keys(count).reduce((a, b) =>\n      count[a] > count[b] ? a : b\n    );\n    id_favorit.push(Number(max));\n    delete count[max];\n  }\n\n  const favorit = await db.barang.findMany({\n    where: {\n      id: { in: id_favorit },\n    },\n  });\n\n  reply.send({\n    status: \"SUCCESS\",\n    message: \"Berhasil get data barang sering dipesan\",\n    data: favorit,\n  })\n}","figma":{}},"title":"barang-favorit","type":"cms-template","lang":"","status":"SYSTEM","parent_id":"14213","slug":"/api/barang/favorit","site":"*","id":"44969"}